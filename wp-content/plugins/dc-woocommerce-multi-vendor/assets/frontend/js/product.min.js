"use strict";var wcmpAfmLibrary=function(o){return{datePickerSelect:function(a){var t=o(a).is(".sale_price_dates_from")?"minDate":"maxDate",e="minDate"===t?o(a).closest(".sale_price_dates_fields").find(".sale_price_dates_to"):o(a).closest(".sale_price_dates_fields").find(".sale_price_dates_from"),i=o(a).datepicker("getDate");o(e).datepicker("option",t,i),o(a).change()},wcEnhancedSelectInit:function(){try{o(":input.wc-enhanced-select, :input.chosen_select").filter(":not(.enhanced)").each(function(){var a={minimumResultsForSearch:10,allowClear:!!o(this).data("allow_clear"),placeholder:o(this).data("placeholder")};o(this).selectWoo(a).addClass("enhanced")}),o(":input.wc-product-search").filter(":not(.enhanced)").each(function(){var a={allowClear:!!o(this).data("allow_clear"),placeholder:o(this).data("placeholder"),minimumInputLength:o(this).data("minimum_input_length")?o(this).data("minimum_input_length"):"3",escapeMarkup:function(a){return a},ajax:{url:wcmp_advance_product_params.ajax_url,dataType:"json",delay:250,data:function(a){return{term:a.term,action:o(this).data("action")||"woocommerce_json_search_products_and_variations",security:wcmp_advance_product_params.search_products_nonce,exclude:o(this).data("exclude"),include:o(this).data("include"),limit:o(this).data("limit")}},processResults:function(a){var e=[];return a&&o.each(a,function(a,t){e.push({id:a,text:t})}),{results:e}},cache:!0}};if(o(this).selectWoo(a).addClass("enhanced"),o(this).data("sortable")){var e=o(this),t=o(this).next(".select2-container").find("ul.select2-selection__rendered");t.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){o(t.find(".select2-selection__choice").get().reverse()).each(function(){var a=o(this).data("data").id,t=e.find('option[value="'+a+'"]')[0];e.prepend(t)})}})}else o(this).prop("multiple")&&o(this).on("change",function(){var a=o(this).children();a.sort(function(a,t){var e=a.text.toLowerCase(),i=t.text.toLowerCase();return i<e?1:e<i?-1:0}),o(this).html(a)})})}catch(a){window.console.log(a)}},wcEnhancedSelectClose:function(){try{o("html").on("click",function(a){this===a.target&&o(".wc-enhanced-select, :input.wc-product-search").filter(".select2-hidden-accessible").selectWoo("close")})}catch(a){window.console.log(a)}},qtip:function(){o(".img_tip").each(function(){o(this).qtip({content:o(this).attr("data-desc"),position:{my:"top center",at:"bottom center",viewport:o(window)},show:{event:"mouseover",solo:!0},hide:{inactive:6e3,fixed:!0},style:{classes:"qtip-dark qtip-shadow qtip-rounded qtip-dc-css",width:200}})})}}}(jQuery),wcmpAfmProductEditor=function(_){var e={productType:_("select#product-type").val(),manageStock:_("input#_manage_stock").is(":checked")},a=null,t=null,i=null;return{getState:function(a){return e.hasOwnProperty(a)?e[a]:""},setState:function(a,t){return!(!e.hasOwnProperty(a)||!t)&&(e[a]=t,!0)},init:function(){_("#woocommerce-product-data").on("change","select#product-type",this.productTypeChanged.bind(this)).on("change","input#_downloadable, input#_virtual",this.updateTabsDisplay.bind(this)).on("click",".sale_schedule",this.showSalePriceDates).on("click",".cancel_sale_schedule",this.hideSalePriceDates).on("change","input#_manage_stock",this.stockManagementPreferenceChanged.bind(this)),_(".add-product-single").on("click",".notice-wrapper button.notice-dismiss",this.dismissNotice),_("#wcmp-edit-product-form").on("click","#wcmp_afm_product_submit, #wcmp_afm_product_draft",this.saveProduct.bind(this)),_("#wcmp-edit-product-form").on("change",'ul.taxonomy-widget input[name^="tax_input"]',this.taxInputChanged.bind(this)),a=this.mediaController(),t=this.downloadsController(),i=this.attributeController(),this.setupEnvironment()},mediaController:function(){var i=null,t=null,r=_("#product_image_gallery");return{init:function(){_(".featured-img").on("click",".upload_image_button:not(.remove)",this.addFeaturedImage).on("click",".upload_image_button.remove",this.removeFeaturedImage),_("#product_images_container").on("click",".add_product_images a",this.addGalleryImages).on("click",".product_images a.delete",this.removeGalleryImage),this.initGalleryImagesSort()},addFeaturedImage:function(a){var t=_(this),e=t.closest(".upload_image");a.preventDefault(),i||(i=wp.media.frames.featured_image=wp.media({title:t.data("title"),button:{text:t.data("button")},states:[new wp.media.controller.Library({title:t.data("title"),filterable:"all"})]})).on("select",function(){var a=i.state().get("selection").first().toJSON(),t=a.sizes&&a.sizes.medium?a.sizes.medium.url:a.url;_(".upload_image_id",e).val(a.id).change(),e.find(".upload_image_button").addClass("remove"),e.find("img").eq(0).attr("src",t)}),i.open()},removeFeaturedImage:function(a){a.preventDefault();var t=_(this).closest(".upload_image");_(".upload_image_id",t).val("").change(),t.find("img").eq(0).attr("src",wcmp_advance_product_params.woocommerce_placeholder_img_src),t.find(".upload_image_button").removeClass("remove")},addGalleryImages:function(a){var i=_(this),o=_("#product_images_container").find("ul.product_images");a.preventDefault(),t||(t=wp.media.frames.product_gallery=wp.media({title:i.data("choose"),button:{text:i.data("update")},states:[new wp.media.controller.Library({title:i.data("choose"),filterable:"all",multiple:!0})]})).on("select",function(){var a=t.state().get("selection"),e=r.val();a.map(function(a){if((a=a.toJSON()).id){e=e?e+","+a.id:a.id;var t=a.sizes&&a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;o.append('<li class="image" data-attachment_id="'+a.id+'"><img src="'+t+'" /><ul class="actions"><li><a href="#" class="delete" title="'+i.data("delete")+'">'+i.data("text")+"</a></li></ul></li>")}}),r.val(e)}),t.open()},removeGalleryImage:function(){_(this).closest("li.image").remove();var t="";return _("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var a=_(this).attr("data-attachment_id");t=t+a+","}),r.val(t),!1},initGalleryImagesSort:function(){_("#product_images_container").find("ul.product_images").sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"product-image-gallery-placeholder",start:function(a,t){t.item.css("background-color","#f6f6f6")},stop:function(a,t){t.item.removeAttr("style")},update:function(){var t="";_("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var a=_(this).attr("data-attachment_id");t=t+a+","}),r.val(t)}})}}},downloadsController:function(){var i,o;return{init:function(){_("#woocommerce-product-data").on("click",".downloadable_files a.insert",this.insertDownloadableFiles).on("click",".downloadable_files a.delete",this.deleteDownloadableFiles).on("click",".downloadable_files a.upload_file_button",this.fileUploaded).on("downloadable_file_fields_inserted",this.sortDownloadableFiles)},insertDownloadableFiles:function(){return _(this).closest(".downloadable_files").find("tbody").append(_(this).data("row")),!1},deleteDownloadableFiles:function(){return _(this).closest("tr").remove(),!1},fileUploaded:function(a){var t=_(this);if(o=t.closest("tr").find("td.file_url input"),a.preventDefault(),i)i.open();else{var e=[new wp.media.controller.Library({library:wp.media.query(),multiple:!0,title:t.data("choose"),priority:20,filterable:"uploaded"})];(i=wp.media.frames.downloadable_file=wp.media({title:t.data("choose"),library:{type:""},button:{text:t.data("update")},multiple:!0,states:e})).on("select",function(){var t="";i.state().get("selection").map(function(a){(a=a.toJSON()).url&&(t=a.url)}),o.val(t).change()}),i.on("ready",function(){i.uploader.options.uploader.params={type:"downloadable_product"}}),i.open()}},sortDownloadableFiles:function(){_(".downloadable_files tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"span.sortable-icon",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"downloadable-files-sortable-placeholder",start:function(a,t){t.item.css("background-color","#f6f6f6")},stop:function(a,t){t.item.removeAttr("style")}})}}},setupEnvironment:function(){_("select#product-type").change(),_("input#_manage_stock").change(),wcmpAfmLibrary.wcEnhancedSelectInit(),wcmpAfmLibrary.wcEnhancedSelectClose(),wcmpAfmLibrary.qtip(),a.init(),t.init(),i.init(),this.salePriceDateFieldInit(_("#woocommerce-product-data")),_("#woocommerce-product-data").trigger("downloadable_file_fields_inserted"),_(".multiselect.product_tag").select2({tags:wcmp_advance_product_params.add_tags,tokenSeparators:[","],placeholder:_(this).data("placeholder")}).on("change",function(){var e=_(this).find('[data-select2-tag="true"]');if(e.length){var a={action:"wcmp_product_tag_add",new_tag:e.val()};_.ajax({type:"POST",url:wcmp_advance_product_params.ajax_url,data:a,success:function(a){if(a.status){var t=a.tag?a.tag.term_id:e.val();e.replaceWith('<option selected value="'+t+'">'+e.val()+"</option>")}else""!=a.message&&(_(".woocommerce-error,woocommerce-message").remove(),_("#wcmp-afm-add-product").prepend('<div class="woocommerce-error" tabindex="-1">'+a.message+"</div>"),_(".woocommerce-error").focus()),_('.multiselect.product_tag option[value="'+e.val()+'"]').remove()}})}}),_("#product_data_tabs").afmTabInit()},salePriceDateFieldInit:function(a){_(".sale_price_dates_fields",a).each(function(){var a=_(this),t=!1,e=a.closest("div.form-group-row");a.find("input").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,onSelect:function(){wcmpAfmLibrary.datePickerSelect(_(this))}}).on("change",function(){if(!_(this).datepicker("getDate")){var a=_(this).is(".sale_price_dates_from")?"minDate":"maxDate",t="minDate"===a?_(this).closest(".sale_price_dates_fields").find(".sale_price_dates_to"):_(this).closest(".sale_price_dates_fields").find(".sale_price_dates_from");_(t).datepicker("option",a,null)}return!1}),a.find("input").each(function(){""!==_(this).val()&&(t=!0),wcmpAfmLibrary.datePickerSelect(_(this))}),t?(e.find(".sale_schedule").hide(),e.find(".sale_price_dates_fields").show()):(e.find(".sale_schedule").show(),e.find(".sale_price_dates_fields").hide())})},productTypeChanged:function(){var a=_("select#product-type").val();this.setState("productType",a),"variable"===a?(_("input#_manage_stock").change(),_("input#_downloadable").prop("checked",!1),_("input#_virtual").removeAttr("checked")):"grouped"===a?(_("input#_downloadable").prop("checked",!1),_("input#_virtual").removeAttr("checked")):"external"===a&&(_("input#_downloadable").prop("checked",!1),_("input#_virtual").removeAttr("checked")),_("#woocommerce-product-data").trigger("afm-product-type-changed"),this.updateTabsDisplay(),_("ul#product_data_tabs li:visible").eq(0).find("a").tab("show")},updateTabsDisplay:function(){var a=this.getState("productType"),t=_("input#_virtual:checked").length,e=_("input#_downloadable:checked").length,i=".hide_if_downloadable, .hide_if_virtual",o=".show_if_downloadable, .show_if_virtual",r=JSON.parse(wcmp_advance_product_params.default_product_types),n=JSON.parse(wcmp_advance_product_params.product_types);_.extend(n,r),_.each(n,function(a,t){i=i+", .hide_if_"+a,o=o+", .show_if_"+a}),_(i).show(),_(o).hide(),e&&_(".show_if_downloadable").show(),t&&_(".show_if_virtual").show(),_(".show_if_"+a).show(),e&&_(".hide_if_downloadable").hide(),t&&_(".hide_if_virtual").hide(),_(".hide_if_"+a).hide(),_("input#_manage_stock").change(),_(".tab-pane").each(function(){var a=_(this).find(".row-padding > div");if(0!==a.length&&a.filter(function(){return"none"===_(this).css("display")}).length===a.length){var t=_(this).prop("id");_("#product_data_tabs").find('li a[href="#'+t+'"]').parent().hide()}}),_("#product_data_tabs").trigger("tab-display-updated")},showSalePriceDates:function(){var a=_(this).closest("div.form-group-row");return _(this).hide(),a.find(".cancel_sale_schedule").show(),a.find(".sale_price_dates_fields").show(),!1},hideSalePriceDates:function(){var a=_(this).closest("div.form-group-row");return _(this).hide(),a.find(".sale_schedule").show(),a.find(".sale_price_dates_fields").hide(),a.find(".sale_price_dates_fields").find("input").val(""),!1},stockManagementPreferenceChanged:function(){var a=this.getState("productType"),t=_("input#_manage_stock").is(":checked");this.setState("manageStock",t),t?(_("div.stock_fields:not( .hide_if_"+a+" )").show(),_("div.stock_status_field").hide()):(_("div.stock_fields").hide(),_("div.stock_status_field:not( .hide_if_"+a+" )").show())},attributeController:function(){var l=this;return{init:function(){var a=_(".product_attributes").find(".woocommerce_attribute").get();_(a).each(function(a,t){_(t).is(".taxonomy")&&_("select.attribute_taxonomy").find('option[value="'+_(t).data("taxonomy")+'"]').attr("disabled","disabled")}),wcmp_advance_product_params.custom_attribute||this.customAttributeCapCheck(),this.initSortableComponent(),_("#product_attributes_data").on("change","input.attribute_name",this.changeCustomAttributeName).on("click","button.select_all_attributes",this.selectAllAttributes).on("click","button.select_no_attributes",this.removeAllAttributes).on("click","button.add_attribute",this.addAttribute.bind(this)).on("click","a.remove_row",this.removeAttribute.bind(this)).on("click",".save_attributes",this.saveAttribute.bind(this)).on("click",".expand_all",this.expandAllAttributes).on("click",".close_all",this.closeAllAttributes)},customAttributeCapCheck:function(){var a=_("select.attribute_taxonomy").children(":not([disabled=disabled])").first().val();a?_("select.attribute_taxonomy").val(a):_("button.add_attribute").attr("disabled","disabled")},initSortableComponent:function(){var e=this,a={items:".woocommerce_attribute",cursor:"move",axis:"y",handle:".variation-title",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wcmp-metabox-sortable-placeholder",start:function(a,t){t.item.css("background-color","#f6f6f6")},stop:function(a,t){t.item.removeAttr("style"),e.updateRowIndices()}};_(".product_attributes").sortable(a)},changeCustomAttributeName:function(){_(this).closest(".woocommerce_attribute").find("strong.attribute_name").text(_(this).val())},selectAllAttributes:function(){return _(this).closest("td").find("select option").attr("selected","selected"),_(this).closest("td").find("select").change(),!1},removeAllAttributes:function(){return _(this).closest("td").find("select option").removeAttr("selected"),_(this).closest("td").find("select").change(),!1},updateRowIndices:function(){_(".product_attributes .woocommerce_attribute").each(function(a,t){_(".attribute_position",t).val(parseInt(_(t).index(".product_attributes .woocommerce_attribute"),10))})},addAttribute:function(a){var t=this,e=_(".product_attributes .woocommerce_attribute").get(),i=0;0<e.length&&(i=e.reduce(function(a,t){var e=parseInt(_(t).find(".woocommerce_attribute_data").attr("id").replace("attribute_",""),10);return isNaN(e)||e<a?a:e},0),++i);var o=_("select.attribute_taxonomy").val();if(o||"1"==wcmp_advance_product_params.custom_attribute){var r=_("#product_attributes_data"),n=r.find(".product_attributes"),c=l.getState("productType"),s={action:"wcmp_edit_product_attribute",taxonomy:o,i:i,security:wcmp_advance_product_params.add_attribute_nonce};r.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),_.post(wcmp_advance_product_params.ajax_url,s,function(a){"-1"!=a&&(n.append(a),"variable"!==c&&n.find(".enable_variation").hide(),wcmpAfmLibrary.wcEnhancedSelectInit(),wcmpAfmLibrary.qtip(),t.updateRowIndices(),n.find(".woocommerce_attribute").last().find(".variation-title").click(),_("#product_attributes_data").trigger("attribute_added")),r.unblock()})}if(o)if(_("select.attribute_taxonomy").find('option[value="'+o+'"]').attr("disabled","disabled"),1==wcmp_advance_product_params.custom_attribute)_("select.attribute_taxonomy").val("");else{var d=_("select.attribute_taxonomy").children(":not([disabled=disabled])").first().val();d?_("select.attribute_taxonomy").val(d):_("button.add_attribute").attr("disabled","disabled")}return!1},removeAttribute:function(a){if(window.confirm(wcmp_advance_product_params.remove_attribute)){var t=_(a.target).closest(".woocommerce_attribute");t.is(".taxonomy")&&_("select.attribute_taxonomy").find('option[value="'+t.data("taxonomy")+'"]').removeAttr("disabled"),t.remove(),this.updateRowIndices()}return!1},saveAttribute:function(a){var t=_("#woocommerce-product-data");t.block({message:null,overlayCSS:{background:"#fff",opacity:.6}});var e={post_id:wcmp_advance_product_params.product_id,product_type:l.getState("productType"),data:_(".product_attributes").find("input, select, textarea").serialize(),action:"wcmp_product_save_attributes",security:wcmp_advance_product_params.save_attributes_nonce};_.post(wcmp_advance_product_params.ajax_url,e,function(){var a=window.location.toString();a=a.replace(/(?:\/#?|\/\d+\/?)?$/,"/"+wcmp_advance_product_params.product_id+"/"),t.unblock(),t.trigger("wcmp_after_save_attribute_triggered")})},expandAllAttributes:function(){return _(this).closest("#product_attributes_data").find(".wcmp-metabox-wrapper > .wcmp-metabox-content").collapse("show"),!1},closeAllAttributes:function(){return _(this).closest("#product_attributes_data").find(".wcmp-metabox-wrapper > .wcmp-metabox-content").collapse("hide"),!1}}},variationController:function(){var o=this,i=null,r=null,n=null;return{init:function(){(i=this.variationActionsController()).init(),(r=this.variationAjaxController()).init(),this.variationMediaController().init(),(n=this.variationPaginationController()).init()},variationActionsController:function(){return{init:function(){_("#variable_product_options").on("change","input.variable_is_downloadable",this.variableIsDownloadable).on("change","input.variable_is_virtual",this.variableIsVirtual).on("change","input.variable_manage_stock",this.variableManageStock).on("click",".woocommerce_variation span.sort.sortable-icon",this.setMenuOrder).on("click",".variation-title select, .variation-title .remove_row",this.stopToggle).on("click",".expand_all",this.expandAllVariations).on("click",".close_all",this.closeAllVariations).on("reload",this.reload),_("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock").change(),_("#woocommerce-product-data").on("woocommerce_variations_loaded",this.variationsLoaded),_(document.body).on("woocommerce_variations_added",this.variationAdded)},initSortableComponent:function(){var a={items:".woocommerce_variation",cursor:"move",axis:"y",handle:".variation-title",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"variation-sortable-placeholder",start:function(a,t){t.item.css("background-color","#f6f6f6")},stop:function(a,t){t.item.removeAttr("style"),i.variationRowIndexes()}};_(".woocommerce_variations").sortable(a)},expandAllVariations:function(){return _(this).closest("#variable_product_options").find(".wcmp-metabox-wrapper > .wcmp-metabox-content").collapse("show"),!1},closeAllVariations:function(){return _(this).closest("#variable_product_options").find(".wcmp-metabox-wrapper > .wcmp-metabox-content").collapse("hide"),!1},reload:function(){r.loadVariations(1),n.setPaginav(0)},variableIsDownloadable:function(){_(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_downloadable").hide(),_(this).is(":checked")&&_(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_downloadable").show()},variableIsVirtual:function(){_(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_virtual").show(),_(this).is(":checked")&&_(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_virtual").hide()},variableManageStock:function(){_(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_manage_stock").hide(),_(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_manage_stock").show(),_(this).is(":checked")&&(_(this).closest(".woocommerce_variable_attributes").find(".show_if_variation_manage_stock").show(),_(this).closest(".woocommerce_variable_attributes").find(".hide_if_variation_manage_stock").hide())},stopToggle:function(a){a.stopPropagation()},variationsLoaded:function(a,t){t=t||!1;var e=_("#woocommerce-product-data");t||(_("input.variable_is_downloadable, input.variable_is_virtual, input.variable_manage_stock",e).change(),_(".woocommerce_variation",e).each(function(a,t){var e=_(t),i=_(".sale_price_dates_from",e).val(),o=_(".sale_price_dates_to",e).val();""===i&&""===o||_("a.sale_schedule",e).click()}),_(".woocommerce_variations .variation-needs-update",e).removeClass("variation-needs-update"),_("button.cancel-variation-changes, button.save-variation-changes",e).attr("disabled","disabled")),o.salePriceDateFieldInit(e),wcmpAfmLibrary.wcEnhancedSelectInit(),wcmpAfmLibrary.qtip(),i.initSortableComponent(),_("#woocommerce-product-data").trigger("downloadable_file_fields_inserted")},variationAdded:function(a,t){1===t&&i.variationsLoaded(null,!0)},setMenuOrder:function(a){a.preventDefault();var t=_(this).closest(".woocommerce_variation").find(".variation_menu_order"),e=window.prompt(wcmp_advance_product_params.i18n_enter_menu_order,t.val()),i=parseInt(e,10);return isNaN(i)||(t.val(i).change(),r.saveVariations()),!1},variationRowIndexes:function(){var a=_("#variable_product_options").find(".woocommerce_variations"),t=parseInt(a.attr("data-page"),10),e=parseInt((t-1)*wcmp_advance_product_params.variations_per_page,10);_(".woocommerce_variations .woocommerce_variation").each(function(a,t){_(".variation_menu_order",t).val(parseInt(_(t).index(".woocommerce_variations .woocommerce_variation"),10)+1+e).change()})}}},variationAjaxController:function(){return{init:function(){_("li.variations_tab a").on("click",this.initialLoad),_("#variable_product_options").on("click","button.save-variation-changes",this.saveVariations).on("click","button.cancel-variation-changes",this.cancelVariations).on("click",".remove_variation",this.removeVariation),_(document.body).on("change","#variable_product_options .woocommerce_variations :input",this.inputChanged).on("change",".variations-defaults select",this.defaultsChanged),_("form#wcmp-afm-add-product").on("submit",this.saveOnSubmit),_(".collapsable-component-wrapper").on("click","a.do_variation_action",this.doVariationAction)},checkForChanges:function(){var a=_("#variable_product_options").find(".woocommerce_variations .variation-needs-update");if(0<a.length){if(!window.confirm(wcmp_advance_product_params.i18n_edited_variations))return a.removeClass("variation-needs-update"),!1;this.saveChanges()}return!0},block:function(){_("#woocommerce-product-data").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){_("#woocommerce-product-data").unblock()},initialLoad:function(){0===_("#variable_product_options").find(".woocommerce_variations .woocommerce_variation").length&&n.goToPage()},loadVariations:function(t,a){t=t||1,a=a||wcmp_advance_product_params.variations_per_page;var e=_("#variable_product_options").find(".woocommerce_variations");r.block(),_.ajax({url:wcmp_advance_product_params.ajax_url,data:{action:"wcmp_afm_load_variations",security:wcmp_advance_product_params.load_variations_nonce,product_id:wcmp_advance_product_params.product_id,attributes:e.data("attributes"),page:t,per_page:a},type:"POST",success:function(a){e.empty().append(a).attr("data-page",t),_("#woocommerce-product-data").trigger("woocommerce_variations_loaded"),r.unblock()}})},getVariationsFields:function(a){var i=_(":input",a).serializeJSON();return _(".variations-defaults select").each(function(a,t){var e=_(t);i[e.attr("name")]=e.val()}),i},saveChanges:function(t){var a=_("#variable_product_options").find(".woocommerce_variations"),e=_(".variation-needs-update",a),i={};0<e.length&&(r.block(),(i=this.getVariationsFields(e)).action="woocommerce_save_variations",i.security=wcmp_advance_product_params.save_variations_nonce,i.product_id=wcmp_advance_product_params.product_id,i["product-type"]=o.getState("productType"),_.ajax({url:wcmp_advance_product_params.ajax_url,data:i,type:"POST",success:function(a){e.removeClass("variation-needs-update"),_("button.cancel-variation-changes, button.save-variation-changes").attr("disabled","disabled"),_("#woocommerce-product-data").trigger("woocommerce_variations_saved"),"function"==typeof t&&t(a),r.unblock()}}))},saveVariations:function(){return _("#variable_product_options").trigger("woocommerce_variations_save_variations_button"),r.saveChanges(function(a){var t=_("#variable_product_options").find(".woocommerce_variations"),e=t.attr("data-page");_("#variable_product_options").find("#woocommerce_errors").remove(),a&&t.before(a),_(".variations-defaults select").each(function(){_(this).attr("data-current",_(this).val())}),n.goToPage(e)}),!1},saveOnSubmit:function(a){0<_("#variable_product_options").find(".woocommerce_variations .variation-needs-update").length&&(a.preventDefault(),_("#variable_product_options").trigger("woocommerce_variations_save_variations_on_submit"),r.saveChanges(r.saveOnSubmitDone))},saveOnSubmitDone:function(){_("form#post").submit()},cancelVariations:function(){var a=parseInt(_("#variable_product_options").find(".woocommerce_variations").attr("data-page"),10);return _("#variable_product_options").find(".woocommerce_variations .variation-needs-update").removeClass("variation-needs-update"),_(".variations-defaults select").each(function(){_(this).val(_(this).attr("data-current"))}),n.goToPage(a),!1},addVariation:function(){this.block();var a={action:"wcmp_afm_add_variation",post_id:wcmp_advance_product_params.product_id,loop:_(".woocommerce_variation").length,security:wcmp_advance_product_params.add_variation_nonce};return _.post(wcmp_advance_product_params.ajax_url,a,function(a){var t=_(a);t.addClass("variation-needs-update"),_("#variable_product_options").find(".woocommerce_variations").prepend(t),_("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),_("#variable_product_options").trigger("woocommerce_variations_added",1),r.unblock()}),!1},removeVariation:function(){if(r.checkForChanges(),window.confirm(wcmp_advance_product_params.i18n_remove_variation)){var a=_(this).attr("rel"),t=[],e={action:"woocommerce_remove_variations"};r.block(),0<a?(t.push(a),e.variation_ids=t,e.security=wcmp_advance_product_params.delete_variations_nonce,_.post(wcmp_advance_product_params.ajax_url,e,function(){var a=_("#variable_product_options").find(".woocommerce_variations"),t=parseInt(a.attr("data-page"),10),e=Math.ceil((parseInt(a.attr("data-total"),10)-1)/wcmp_advance_product_params.variations_per_page),i=1;_("#woocommerce-product-data").trigger("woocommerce_variations_removed"),t===e||t<=e?i=t:e<t&&0!==e&&(i=e),n.goToPage(i,-1)})):r.unblock()}return!1},linkAllVariations:function(){if(this.checkForChanges(),window.confirm(wcmp_advance_product_params.i18n_link_all_variations)){this.block();var a={action:"woocommerce_link_all_variations",post_id:wcmp_advance_product_params.product_id,security:wcmp_advance_product_params.link_variation_nonce};_.post(wcmp_advance_product_params.ajax_url,a,function(a){var t=parseInt(a,10);1===t?window.alert(t+" "+wcmp_advance_product_params.i18n_variation_added):0===t||1<t?window.alert(t+" "+wcmp_advance_product_params.i18n_variations_added):window.alert(wcmp_advance_product_params.i18n_no_variations_added),0<t?(n.goToPage(1,t),_("#variable_product_options").trigger("woocommerce_variations_added",t)):r.unblock()})}return!1},inputChanged:function(){_(this).closest(".woocommerce_variation").addClass("variation-needs-update"),_("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),_("#variable_product_options").trigger("woocommerce_variations_input_changed")},defaultsChanged:function(){_(this).closest("#variable_product_options").find(".woocommerce_variation:first").addClass("variation-needs-update"),_("button.cancel-variation-changes, button.save-variation-changes").removeAttr("disabled"),_("#variable_product_options").trigger("woocommerce_variations_defaults_changed")},doVariationAction:function(){var a,t=_("select.variation_actions").val(),e={},i=0;switch(t){case"add_variation":return void r.addVariation();case"link_all_variations":return void r.linkAllVariations();case"delete_all":window.confirm(wcmp_advance_product_params.i18n_delete_all_variations)&&window.confirm(wcmp_advance_product_params.i18n_last_warning)&&(e.allowed=!0,i=-1*parseInt(_("#variable_product_options").find(".woocommerce_variations").attr("data-total"),10));break;case"variable_regular_price_increase":case"variable_regular_price_decrease":case"variable_sale_price_increase":case"variable_sale_price_decrease":if(null===(a=window.prompt(wcmp_advance_product_params.i18n_enter_a_value_fixed_or_percent)))return;0<=a.indexOf("%")?e.value=accounting.unformat(a.replace(/\%/,""),wcmp_advance_product_params.mon_decimal_point)+"%":e.value=accounting.unformat(a,wcmp_advance_product_params.mon_decimal_point);break;case"variable_regular_price":case"variable_sale_price":case"variable_stock":case"variable_weight":case"variable_length":case"variable_width":case"variable_height":case"variable_download_limit":case"variable_download_expiry":if(null===(a=window.prompt(wcmp_advance_product_params.i18n_enter_a_value)))return;e.value=a;break;case"variable_sale_schedule":if(e.date_from=window.prompt(wcmp_advance_product_params.i18n_scheduled_sale_start),e.date_to=window.prompt(wcmp_advance_product_params.i18n_scheduled_sale_end),null===e.date_from&&(e.date_from=!1),null===e.date_to&&(e.date_to=!1),!1===e.date_to&&!1===e.date_from)return;break;default:_("select.variation_actions").trigger(t),e=_("select.variation_actions").triggerHandler(t+"_ajax_data",e)}"delete_all"===t&&e.allowed?_("#variable_product_options").find(".variation-needs-update").removeClass("variation-needs-update"):r.checkForChanges(),r.block(),_.ajax({url:wcmp_advance_product_params.ajax_url,data:{action:"woocommerce_bulk_edit_variations",security:wcmp_advance_product_params.bulk_edit_variations_nonce,product_id:wcmp_advance_product_params.product_id,product_type:o.getState("productType"),bulk_action:t,data:e},type:"POST",success:function(){n.goToPage(1,i)}})}}},variationMediaController:function(){var o=null,r=null,n=null,c=wp.media.model.settings.post.id;return{init:function(){_("#variable_product_options").on("click",".upload_image_button",this.addImage),_("a.add_media").on("click",this.restoreWPMediaPostId)},addImage:function(a){var t=_(this),e=t.attr("rel"),i=t.closest(".upload_image");if(n=i,r=e,a.preventDefault(),t.is(".remove"))_(".upload_image_id",n).val("").change(),n.find("img").eq(0).attr("src",wcmp_advance_product_params.woocommerce_placeholder_img_src),n.find(".upload_image_button").removeClass("remove");else{if(o)return o.uploader.uploader.param("post_id",r),void o.open();wp.media.model.settings.post.id=r,(o=wp.media.frames.variable_image=wp.media({title:wcmp_advance_product_params.i18n_choose_image,button:{text:wcmp_advance_product_params.i18n_set_image},states:[new wp.media.controller.Library({title:wcmp_advance_product_params.i18n_choose_image,filterable:"all"})]})).on("select",function(){var a=o.state().get("selection").first().toJSON(),t=a.sizes&&a.sizes.thumbnail?a.sizes.thumbnail.url:a.url;_(".upload_image_id",n).val(a.id).change(),n.find(".upload_image_button").addClass("remove"),n.find("img").eq(0).attr("src",t),wp.media.model.settings.post.id=c}),o.open()}},restoreWPMediaPostId:function(){wp.media.model.settings.post.id=c}}},variationPaginationController:function(){return{init:function(){_(document.body).on("woocommerce_variations_added",this.updateSingleQuantity).on("change",".variations-pagenav .page-selector",this.pageSelector).on("click",".variations-pagenav .first-page",this.firstPage).on("click",".variations-pagenav .prev-page",this.prevPage).on("click",".variations-pagenav .next-page",this.nextPage).on("click",".variations-pagenav .last-page",this.lastPage)},updateVariationsCount:function(a){var t=_("#variable_product_options").find(".woocommerce_variations"),e=parseInt(t.attr("data-total"),10)+a,i=_(".variations-pagenav .displaying-num");return t.attr("data-total",e),1===e?i.text(wcmp_advance_product_params.i18n_variation_count_single.replace("%qty%",e)):i.text(wcmp_advance_product_params.i18n_variation_count_plural.replace("%qty%",e)),e},updateSingleQuantity:function(a,t){if(1===t){var e=_(".variations-pagenav");n.updateVariationsCount(t),e.is(":hidden")&&(_("option, optgroup",".variation_actions").show(),_(".variation_actions").val("add_variation"),_("#variable_product_options").find(".toolbar").show(),e.show(),_(".pagination-links",e).hide())}},setPaginav:function(a){var t=_("#variable_product_options").find(".woocommerce_variations"),e=this.updateVariationsCount(a),i=_("#variable_product_options").find(".toolbar"),o=_(".variation_actions"),r=_(".variations-pagenav"),n=_(".pagination-links",r),c=Math.ceil(e/wcmp_advance_product_params.variations_per_page),s="";t.attr("data-total_pages",c),_(".total-pages",r).text(c);for(var d=1;d<=c;d++)s+='<option value="'+d+'">'+d+"</option>";_(".page-selector",r).empty().html(s),0===e?(i.not(".toolbar-top, .toolbar-buttons").hide(),r.hide(),_("option, optgroup",o).hide(),_(".variation_actions").val("add_variation"),_('option[data-global="true"]',o).show()):(i.show(),r.show(),_("option, optgroup",o).show(),_(".variation_actions").val("add_variation"),1===c?n.hide():n.show())},checkIsEnabled:function(a){return!_(a).hasClass("disabled")},changeClasses:function(a,t){var e=_(".variations-pagenav .first-page"),i=_(".variations-pagenav .prev-page"),o=_(".variations-pagenav .next-page"),r=_(".variations-pagenav .last-page");1===a?(e.addClass("disabled"),i.addClass("disabled")):(e.removeClass("disabled"),i.removeClass("disabled")),t===a?(o.addClass("disabled"),r.addClass("disabled")):(o.removeClass("disabled"),r.removeClass("disabled"))},setPage:function(a){_(".variations-pagenav .page-selector").val(a).first().change()},goToPage:function(a,t){a=a||1,t=t||0,this.setPaginav(t),this.setPage(a)},pageSelector:function(){var a=parseInt(_(this).val(),10),t=_("#variable_product_options").find(".woocommerce_variations");_(".variations-pagenav .page-selector").val(a),r.checkForChanges(),n.changeClasses(a,parseInt(t.attr("data-total_pages"),10)),r.loadVariations(a)},firstPage:function(){return n.checkIsEnabled(this)&&n.setPage(1),!1},prevPage:function(){if(n.checkIsEnabled(this)){var a=_("#variable_product_options").find(".woocommerce_variations"),t=parseInt(a.attr("data-page"),10)-1,e=0<t?t:1;n.setPage(e)}return!1},nextPage:function(){if(n.checkIsEnabled(this)){var a=_("#variable_product_options").find(".woocommerce_variations"),t=parseInt(a.attr("data-total_pages"),10),e=parseInt(a.attr("data-page"),10)+1,i=e<=t?e:t;n.setPage(i)}return!1},lastPage:function(){if(n.checkIsEnabled(this)){var a=_("#variable_product_options").find(".woocommerce_variations").attr("data-total_pages");n.setPage(a)}return!1}}}}},dismissNotice:function(){_(this).parent().remove()},getTinymceContent:function(a){return _("#wp-"+a+"-wrap").hasClass("tmce-active")&&"undefined"!=typeof tinyMCE&&tinyMCE.get(a)?tinyMCE.get(a).getContent():_("textarea#"+a).val()},saveProduct:function(a){_("form#wcmp-edit-product-form").trigger("before_product_save");var t="wcmp_afm_product_submit"===a.target.id?"publish":"wcmp_afm_product_draft"===a.target.id?"draft":"";return _('input:hidden[name="status"]').val(t),_("textarea#product_description").val(this.getTinymceContent("product_description")),_("textarea#product_excerpt").val(this.getTinymceContent("product_excerpt")),!0},taxInputChanged:function(a){_(this).is(":checked")||_(this).prop("checked",!1)}}}(jQuery);jQuery(function(){wcmpAfmProductEditor.init()});